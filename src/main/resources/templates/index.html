<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Currency Exchange Visualisation</title>
    <link href="style.css" rel="stylesheet" type="text/css">

    <!---------------------------------------------- 4 ---------------------------------------------------->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Date');
            data.addColumn('number', 'Rate');

            var list = [[${list}]];
            for (var i = 0; i < list.length; i++) {
                var l = list[i];
                var year = l.date.substring(0, 4);
                var month = l.date.substring(5, 7);
                var day = l.date.substring(8, 10);
                var tempDate = day + '-' + month + '-' + year + ' ' + l.date.substring(11, 16);

                data.addRow(
                    [tempDate, l.open]
                );
                data.addRow(
                    ['', l.high]
                );
                data.addRow(
                    ['', l.low]
                );
                data.addRow(
                    ['', l.close]
                );
            }

            var choice1 = [[${choice1}]];
            var choice2 = [[${choice2}]];
            var options = {
                title: 'Historical conversion rate from ' + choice1 + ' to ' + choice2,
                curveType: 'function',
                legend: {position: 'top'},
                trendlines: {
                    0: {
                        color: 'black',
                        lineWidth: 1,
                        visibleInLegend: true
                    }},
                hAxis: {
                    textStyle: {fontSize: 11, color: 'gray'},
                    allowContainerBoundaryTextCufoff: false
                },
                vAxis:{
                    format: 'decimal'
                },
                series: {
                    0: {color: 'dodgerblue', visibleInLegend: true, lineWidth: 1}
                }
            };

            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

            chart.draw(data, options);
        }
    </script>
    <!------------------------------------------ 4 ------------------------------------------------------->

</head>
<body>
<!--<form method="post" th:action="@{/}" th:object="${currencyData}">-->
<div class="container">
    <form th:action="@{/}" method="post" th:object="${currencyData}">
        <div class="d1">
            <div class="d1-a">
                <div>
                    <p>Select exchange currencies
                    <p><span class="txt">From: </span>
                        <label>
                            <select th:field="*{choice1}" class="list" th:value="Select" id="sel1">
                                <option value="">Select</option>
                                <option th:each="entry : ${currencyData.getPool().entrySet()}" th:value="${entry.key}"
                                        th:text="${entry.key}" th:title="${entry.value}">
                            </select>
                        </label>
                        <span class="txt">To: </span>
                        <label>
                            <select th:field="*{choice2}" class="list" th:value="Select" id="sel2">
                                <option value="">Select</option>
                                <option th:each="entry : ${currencyData.getPool().entrySet()}" th:value="${entry.key}"
                                        th:text="${entry.key}">
                            </select>
                        </label>
                        <button type="submit" name="get_rate" class="button">
                            Submit
                        </button>
                    </p>
                </div>
            </div>
            <div class="d2">
                <div>
                    <span class="txt">Real-time exchange rate: </span>
                    <div class="real"><span class="info" th:text="${realtime}"></span></div>
                </div>
                <div class="d3">
                    <span class="currency" th:text="${currencyData.getChoice1()}"></span>
                    <span class="currency" th:text="${currencyData.getChoice2()}"></span>
                    <button type="submit" name="exchange" class="button">
                        <=>
                    </button>
                </div>
            </div>
        </div>
    </form>
    <!-- 5 -->
    <div id="chart_div" onchange="drawChart()">
        <div>
            <span class="message" th:text="${errorMessage}"></span></div>
    </div>
    <!-- 5 -->
</div>
</body>
</html>